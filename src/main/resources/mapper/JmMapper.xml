<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tencent.wxcloudrun.dao.JmMapper">
    <insert id="insertLottery">
        insert into jm_lottery_result (id, open_id, lottery_code, lottery_name, fill_date)
        values (
            uuid(), #{openId}, #{lotteryCode}, #{lotteryName}, sysdate()
        )
    </insert>

    <select id="getValidCount" resultType="java.lang.Integer">
        select case when count(id) > 0 then 0 else 1 end
        from jm_lottery_result
        where open_id = #{openId} and  date_format(fill_date, '%Y-%m-%d') = date_format(sysdate(), '%Y-%m-%d')
    </select>
</mapper>
